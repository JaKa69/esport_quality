<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Inscription</title>
</head>
<body>
<h1>Créer un compte</h1>

<form id="register-form">
    <label for="username">Nom d'utilisateur :</label>
    <input type="text" id="username" name="username" required><br><br>

    <label for="firstName">Prénom :</label>
    <input type="text" id="firstName" name="firstName" required><br><br>

    <label for="lastName">Nom :</label>
    <input type="text" id="lastName" name="lastName" required><br><br>

    <label for="mail">Adresse mail :</label>
    <input type="email" id="mail" name="mail" required><br><br>

    <label for="password">Mot de passe :</label>
    <input type="password" id="password" name="password" required><br><br>

    <button type="submit">S'inscrire</button>
</form>

<div id="message"></div>

<script>
    document.getElementById("register-form").addEventListener("submit", async function (e) {
        e.preventDefault();

        const data = {
            lastName: document.getElementById("lastName").value,
            password: document.getElementById("password").value,
            mail: document.getElementById("mail").value,
            login: document.getElementById("username").value,
            firstName: document.getElementById("firstName").value,
        };
        console.log(data);
        const response = await fetch("/register", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(data)
        })
        .then(response => {
            if (response.ok) {
                // Redirige vers /home si login réussi
                window.location.href = "/home.html";
            } else {
                return response.text().then(msg => alert("Échec de connexion"));
            }
        });

        const messageDiv = document.getElementById("message");

        if (response.ok) {
            const user = await response.json();
            messageDiv.innerText = `Bienvenue ${user.firstName} ! Votre compte a été créé.`;
            // Redirection possible ici
            // window.location.href = "/login";
        } else {
            messageDiv.innerText = "Erreur : mail déjà utilisé ou données invalides.";
        }
    });
</script>
</body>
</html>
